<!-- FinBlog/includes/ppt-card-overlay.html -->
<div class="ppt-link-container">
    <a class="ppt-link" id="open-ppt">
        <i class="fas fa-file-powerpoint"></i>
        View Course Presentation
    </a>
</div>

<!-- PPT Overlay -->
<div class="overlay" id="ppt-overlay">
    <!-- Dedicated background layer to capture clicks -->
    <div class="overlay-bg"></div>
    <div class="ppt-viewer">
        <div class="ppt-content" id="ppt-content-scroll">
            <div id="slide-container">
                <!-- Slides will be rendered here -->
            </div>
        </div>
    </div>
</div>

<script>
    // ===== PRESENTATION SLIDES =====
    // **IMPORTANT:** Set the pptJsonPath in the layout file where you include this component!
    // const pptJsonPath = '/assets/img/reports/PPTs/Report-1-Ppts/slides.json'; // Path will be set dynamically in layout

    // DOM Elements (scoped to this component)
    const openPptBtn = document.getElementById('open-ppt');
    const pptOverlay = document.getElementById('ppt-overlay');
    const slideContainer = document.getElementById('slide-container');
    const overlayBg = document.querySelector('.overlay-bg');

    if (openPptBtn && pptOverlay && slideContainer && overlayBg) { // Check if elements exist before adding listeners
        // Open overlay and load slides
        openPptBtn.addEventListener('click', () => {
            pptOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            loadAndRenderSlides(); // Call function to load and render slides
        });

        // Close overlay when clicking the dedicated background
        overlayBg.addEventListener('click', () => {
            pptOverlay.classList.remove('active');
            document.body.style.overflow = '';
        });

        // Keyboard navigation (Escape key to close overlay)
        document.addEventListener('keydown', (e) => {
            if (!pptOverlay.classList.contains('active')) return;
            if (e.key === 'Escape') {
                pptOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        });

        // Function to render all slides
        function renderAllSlides(slides) {
            slideContainer.innerHTML = '';
            slides.forEach(slide => {
                const slideDiv = document.createElement('div');
                slideDiv.classList.add('ppt-slide');
                slideDiv.innerHTML = `
                    <h2 style="color: var(--primary); margin-bottom: 1rem; text-align: center;">
                        ${slide.title}
                    </h2>
                    <img src="${slide.image}" alt="${slide.title}" style="max-width: 100%; max-height: 80%; border: 1px solid #ddd; display: block; margin: 0 auto 1rem auto;" />
                    <p style="margin-top: 1rem; text-align: center; font-size: 1.25rem;">
                        ${slide.content}
                    </p>
                `;
                slideContainer.appendChild(slideDiv);
            });
        }

        // Function to load and render slides from JSON
        function loadAndRenderSlides() {
            // **IMPORTANT:** pptJsonPath is expected to be defined in the layout file
            if (typeof pptJsonPath !== 'undefined') { // Check if pptJsonPath is defined
                fetch(pptJsonPath)
                    .then(response => response.json())
                    .then(slidesData => {
                        renderAllSlides(slidesData); // Render slides using fetched data
                    })
                    .catch(error => {
                        console.error("Error fetching slides.json:", error);
                        slideContainer.innerHTML = "<p>Failed to load presentation slides.</p>"; // Display error message
                    });
            } else {
                console.error("pptJsonPath is not defined. Set it in the layout file.");
                slideContainer.innerHTML = "<p>Presentation path not configured.</p>"; // Display config error
            }
        }
    } else {
        console.error("PPT component DOM elements not found in ppt-card-overlay.html.");
    }
</script>