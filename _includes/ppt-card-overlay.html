<!-- FinBlog/includes/ppt-card-overlay.html -->
<div class="ppt-link-container">
    <a class="ppt-link" id="open-ppt">
        <i class="fas fa-file-powerpoint"></i>
        View Course Presentation
    </a>
</div>

<!-- PPT Overlay -->
<div class="overlay" id="ppt-overlay">
    <!-- Close button for better UX -->
    <button class="ppt-close-btn" id="ppt-close-btn" aria-label="Close presentation">Ã—</button>
    <!-- Dedicated background layer to capture clicks -->
    <div class="overlay-bg"></div>
    <div class="ppt-viewer">
        <div class="ppt-content" id="ppt-content-scroll">
            <div id="slide-container">
                <!-- Slides will be rendered here -->
            </div>
        </div>
    </div>
</div>

<style>
/* Add these styles to make sure the close button is visible and clickable */
.ppt-close-btn {
    position: fixed;
    top: 20px;
    right: 30px;
    font-size: 40px;
    color: white;
    background: transparent;
    border: none;
    cursor: pointer;
    z-index: 2000;
    padding: 10px;
    line-height: 0.5;
    position: fixed; /* Ensure it stays fixed on the viewport */
    transition: none; /* Disable any transitions that might affect positioning */
}


.ppt-close-btn:hover {
    color: #ddd;
}
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // ===== PRESENTATION SLIDES =====
        // DOM Elements
        const openPptBtn = document.getElementById('open-ppt');
        const pptOverlay = document.getElementById('ppt-overlay');
        const closeBtn = document.getElementById('ppt-close-btn');
        const slideContainer = document.getElementById('slide-container');
        
        // Close overlay function
        function closeOverlay() {
            if (pptOverlay) {
                pptOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        }
        
        // Open overlay when clicking the button
        if (openPptBtn) {
            openPptBtn.addEventListener('click', function() {
                if (pptOverlay) {
                    pptOverlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                    loadAndRenderSlides();
                }
            });
        }
        
        // Close overlay with close button
        if (closeBtn) {
            closeBtn.addEventListener('click', closeOverlay);
        }
        
        // Close with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && pptOverlay && pptOverlay.classList.contains('active')) {
                closeOverlay();
            }
        });
        
        // Close when clicking outside the content area
        if (pptOverlay) {
            pptOverlay.addEventListener('click', function(e) {
                // Close if clicking directly on the overlay, not on its children
                if (e.target === pptOverlay || e.target.classList.contains('overlay-bg')) {
                    closeOverlay();
                }
            });
        }
        
        // Function to render all slides
        function renderAllSlides(slides) {
            if (!slideContainer) return;
            
            slideContainer.innerHTML = '';
            slides.forEach(slide => {
                const slideDiv = document.createElement('div');
                slideDiv.classList.add('ppt-slide');
                slideDiv.innerHTML = `
                    <h2 style="color: var(--primary); margin-bottom: 1rem; text-align: center;">
                        ${slide.title}
                    </h2>
                    <img src="${slide.image}" alt="${slide.title}" style="max-width: 100%; max-height: 80%; border: 1px solid #ddd; display: block; margin: 0 auto 1rem auto;" />
                    <p style="margin-top: 1rem; text-align: center; font-size: 1.25rem;">
                        ${slide.content}
                    </p>
                `;
                slideContainer.appendChild(slideDiv);
            });
        }

        // Function to load and render slides from JSON
        function loadAndRenderSlides() {
            if (!slideContainer) return;
            
            // Check if pptJsonPath is defined
            if (typeof pptJsonPath !== 'undefined') {
                fetch(pptJsonPath)
                    .then(response => response.json())
                    .then(slidesData => {
                        renderAllSlides(slidesData);
                    })
                    .catch(error => {
                        console.error("Error fetching slides.json:", error);
                        slideContainer.innerHTML = "<p>Failed to load presentation slides.</p>";
                    });
            } else {
                console.error("pptJsonPath is not defined. Set it in the layout file.");
                slideContainer.innerHTML = "<p>Presentation path not configured.</p>";
            }
        }
    });
</script>